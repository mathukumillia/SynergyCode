<html>

<head>
<title><%= title %></title>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<link rel="stylesheet" href="stylesheets/filetest.css">
<link rel="stylesheet" type="text/css" href="stylesheets/codemirror.css">
<script src="codemirror.js"></script>
<script src="xml.js"></script>
<script src="active-line.js"></script>

</head>

<body>

<h1>Welcome to FC Protocol!</h1>
<a href = "create.html" onClick = "reRoute()">Create File</a>
<br/>

<table id = "selectMenu">
<tr>
        <td><h2>Files</h2></td>
</tr>
<tr>
        <td class = "selector" onClick = "fileLoader('testFile1.html')">File1</td>
</tr>
<tr>
        <td class = "selector" onClick = "fileLoader('testFile2.html')">File2</td>
</tr>
</table>

<table id = "mainTable">
        <tr id = "headerow">
                <td>Code</td>
                <td>Live Preview</td>
        </tr>
        <tr>
                <td><textarea id = "editor" rows = "20"></textarea></td>
                <td><iframe name = "preview"></iframe></td>
        </tr>
</table>

<script>
        var socket = io.connect('http://localhost');
        var loadedFileName;

        window.onload = function () {
            socket.on('message', function (data) {
                alert('Its ready to go!');
            });
        }

        function reRoute() {
            alert('rerouting');
        }

        function fileLoader(fileName) {
            loadedFileName = fileName;
            socket.emit('fileLoad', {
                message: fileName
            });
        }

        function preview(file) {
            var html = $.parseHTML(file, document, true);
            $('[name="preview"]').contents().find("html").html(html);
        }

        socket.on('fileData', function (data) {
            editor.setValue(data.message);
            preview(data.message);
        });

        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            mode: "application/xml",
            styleActiveLine: true,
            lineNumbers: true,
            lineWrapping: true
        });
        editor.on('change',function(cMirror){
                var fileData = editor.getValue();
                preview(fileData);
                socket.emit('fileChanged', {
                        message: fileData
                });
        });
</script>

</body>

</html>